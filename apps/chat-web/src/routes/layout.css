@import 'tailwindcss';
@plugin '@tailwindcss/typography';

@custom-variant dark (&:where(.dark, .dark *));

@font-face {
	font-family: 'GeistMono';
	src: url('/GeistMono[wght].woff2') format('woff2');
	font-weight: 100 900;
	font-style: normal;
}

@font-face {
	font-family: 'Geist';
	src: url('/Geist[wght].woff2') format('woff2');
	font-weight: 100 900;
	font-style: normal;
}

@theme {
	--font-family-geist:
		'Geist', ui-sans-serif, system-ui, -apple-system, 'BlinkMacSystemFont', 'Segoe UI', sans-serif;
	--font-family-geist-mono:
		'GeistMono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono',
		'Courier New', monospace;
	--font-family-ui: var(--font-family-geist-mono);
}

@layer base {
	:root {
		color-scheme: light;

		--bc-bg: 0 0% 96%;
		--bc-bg-2: 0 0% 92%;
		--bc-fg: 0 0% 8%;
		--bc-fg-muted: 0 0% 40%;
		--bc-border: 0 0% 78%;
		--bc-surface: 0 0% 100%;
		--bc-surface-2: 0 0% 94%;

		--bc-accent: 18 95% 52%;
		--bc-accent-2: 0 0% 8%;
		--bc-accent-3: 0 0% 8%;

		--bc-success: 142 76% 36%;
		--bc-warning: 38 92% 50%;
		--bc-error: 0 84% 60%;

		--bc-shadow: 0 0% 0%;
	}

	:root.dark {
		color-scheme: dark;

		--bc-bg: 0 0% 6%;
		--bc-bg-2: 0 0% 10%;
		--bc-fg: 0 0% 95%;
		--bc-fg-muted: 0 0% 68%;
		--bc-border: 0 0% 22%;
		--bc-surface: 0 0% 10%;
		--bc-surface-2: 0 0% 14%;

		--bc-accent: 18 96% 56%;
		--bc-accent-2: 0 0% 95%;
		--bc-accent-3: 0 0% 95%;

		--bc-success: 142 71% 45%;
		--bc-warning: 38 92% 50%;
		--bc-error: 0 84% 60%;

		--bc-shadow: 0 0% 0%;
	}

	html,
	body {
		height: 100%;
		font-family: var(--font-family-ui);
		font-variation-settings: 'opsz' 28;
		text-rendering: geometricPrecision;
	}

	body {
		background: hsl(var(--bc-bg));
		color: hsl(var(--bc-fg));
		@apply antialiased;
	}

	::selection {
		background: color-mix(in oklab, hsl(var(--bc-accent)) 22%, transparent);
	}

	a {
		@apply underline underline-offset-4;
		text-decoration-color: color-mix(in oklab, hsl(var(--bc-border)) 60%, transparent);
	}

	a:hover {
		text-decoration-color: color-mix(in oklab, hsl(var(--bc-accent)) 65%, transparent);
	}

	:focus-visible {
		outline: 2px solid color-mix(in oklab, hsl(var(--bc-accent)) 85%, white);
		outline-offset: 2px;
		border-radius: 0;
	}

	code,
	pre,
	textarea {
		font-family: var(--font-family-geist-mono);
		font-variation-settings: 'opsz' 28;
	}
}

@layer components {
	.bc-container {
		@apply mx-auto w-full max-w-5xl px-6;
	}

	.bc-appBg {
		background: hsl(var(--bc-bg));
	}

	.bc-header {
		border-bottom: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-bg));
		backdrop-filter: none;
	}

	.bc-logoMark {
		display: grid;
		place-items: center;
		width: 42px;
		height: 42px;
		border-radius: 0;
		background: hsl(var(--bc-surface));
		border: 1px solid hsl(var(--bc-border));
		color: hsl(var(--bc-fg));
	}

	.bc-title {
		font-weight: 650;
		letter-spacing: -0.03em;
	}

	.bc-subtitle {
		color: hsl(var(--bc-fg-muted));
		letter-spacing: 0.01em;
	}

	.bc-chip {
		display: inline-flex;
		align-items: center;
		gap: 10px;
		padding: 10px 12px;
		border-radius: 0;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		color: hsl(var(--bc-fg));
		text-decoration: none;
		transition:
			background 120ms ease,
			border-color 120ms ease;
	}

	.bc-chip:hover {
		border-color: hsl(var(--bc-fg));
		background: hsl(var(--bc-surface-2));
		transform: translateY(-1px);
	}

	.bc-card {
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		border-radius: 0;
	}

	.bc-btn {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: 8px;
		padding: 10px 16px;
		border-radius: 0;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		color: hsl(var(--bc-fg));
		font-weight: 600;
		font-size: 13px;
		text-decoration: none;
		cursor: pointer;
		transition:
			background 120ms ease,
			border-color 120ms ease;
	}

	.bc-btn:hover {
		border-color: hsl(var(--bc-fg));
		background: hsl(var(--bc-surface-2));
	}

	.bc-btn:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.bc-btn-primary {
		background: hsl(var(--bc-fg));
		color: hsl(var(--bc-bg));
		border-color: hsl(var(--bc-fg));
	}

	.bc-btn-primary:hover {
		background: hsl(var(--bc-accent));
		border-color: hsl(var(--bc-accent));
	}

	.bc-input {
		width: 100%;
		padding: 12px 16px;
		border-radius: 0;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		color: hsl(var(--bc-fg));
		font-size: 14px;
		transition: border-color 120ms ease;
	}

	.bc-input:focus {
		outline: none;
		border-color: hsl(var(--bc-accent));
	}

	.bc-input::placeholder {
		color: hsl(var(--bc-fg-muted));
	}

	.bc-muted {
		color: hsl(var(--bc-fg-muted));
	}

	.bc-badge {
		display: inline-flex;
		align-items: center;
		gap: 6px;
		padding: 4px 8px;
		border-radius: 0;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		font-size: 12px;
		font-weight: 600;
	}

	.bc-badge-success {
		border-color: hsl(var(--bc-success));
		color: hsl(var(--bc-success));
	}

	.bc-badge-warning {
		border-color: hsl(var(--bc-warning));
		color: hsl(var(--bc-warning));
	}

	.bc-badge-error {
		border-color: hsl(var(--bc-error));
		color: hsl(var(--bc-error));
	}

	/* Chat-specific styles */
	.chat-messages {
		display: flex;
		flex-direction: column;
		gap: 16px;
		overflow-y: auto;
		padding: 20px;
		max-width: 800px;
		margin: 0 auto;
		width: 100%;
	}

	.chat-message {
		display: flex;
		flex-direction: column;
		padding: 12px 16px;
	}

	.chat-message-user {
		background: hsl(var(--bc-surface-2));
		border: 1px solid hsl(var(--bc-border));
	}

	.chat-message-assistant {
		background: transparent;
		padding: 6px 0;
	}

	.chat-message-system {
		background: hsl(var(--bc-surface));
		border: 1px solid hsl(var(--bc-border));
		padding: 12px 16px;
	}

	.chat-input-container {
		padding: 16px 20px;
		border-top: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-bg));
		max-width: 64rem;
		margin: 0 auto;
		width: 100%;
	}

	/* Input wrapper with flexbox */
	.input-wrapper {
		position: relative;
		display: flex;
		align-items: flex-start;
		gap: 8px;
	}

	.chat-input-highlight-wrapper {
		flex: 1;
		position: relative;
	}

	.chat-input-backdrop {
		position: absolute;
		inset: 0;
		padding: 12px 14px;
		border: 1px solid transparent;
		font-size: 14px;
		font-family: var(--font-family-geist-mono);
		line-height: 1.5;
		white-space: pre-wrap;
		word-wrap: break-word;
		overflow: hidden;
		pointer-events: none;
		color: transparent;
	}

	.mention-highlight {
		color: hsl(var(--bc-accent));
		background: hsl(var(--bc-accent) / 0.15);
	}

	.chat-input {
		position: relative;
		width: 100%;
		padding: 12px 14px;
		border: 1px solid hsl(var(--bc-accent));
		background: transparent;
		color: hsl(var(--bc-fg));
		caret-color: hsl(var(--bc-fg));
		font-size: 14px;
		font-family: var(--font-family-geist-mono);
		resize: none;
		line-height: 1.5;
		field-sizing: content;
		min-height: calc(2lh + 24px);
		max-height: calc(4lh + 24px);
		overflow-y: auto;
	}

	.chat-input:focus {
		outline: none;
		border-color: hsl(var(--bc-accent));
	}

	.chat-input::placeholder {
		color: hsl(var(--bc-fg-muted));
	}

	.chat-input:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.send-btn {
		flex-shrink: 0;
		width: 42px;
		height: 42px;
		padding: 0;
		background: hsl(var(--bc-fg));
		color: hsl(var(--bc-bg));
		border: none;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.send-btn:hover:not(:disabled) {
		background: hsl(var(--bc-accent));
	}

	.send-btn:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	/* Mention menu */
	.mention-menu {
		position: absolute;
		bottom: calc(100% + 4px);
		left: 0;
		right: 0;
		background: hsl(var(--bc-surface));
		border: 1px solid hsl(var(--bc-accent));
		max-height: 200px;
		overflow-y: auto;
		z-index: 50;
	}

	.mention-item {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 10px 14px;
		cursor: pointer;
		border-bottom: 1px solid hsl(var(--bc-border));
	}

	.mention-item:last-child {
		border-bottom: none;
	}

	.mention-item:hover,
	.mention-item-selected {
		background: hsl(var(--bc-surface-2));
	}

	.mention-item-selected {
		color: hsl(var(--bc-accent));
	}

	/* Markdown prose styling */
	.prose {
		/* Override Tailwind Typography defaults to match bc neutrals */
		--tw-prose-body: hsl(var(--bc-fg));
		--tw-prose-headings: hsl(var(--bc-fg));
		--tw-prose-lead: hsl(var(--bc-fg));
		--tw-prose-links: hsl(var(--bc-accent));
		--tw-prose-bold: hsl(var(--bc-fg));
		--tw-prose-counters: hsl(var(--bc-fg-muted));
		--tw-prose-bullets: hsl(var(--bc-fg-muted));
		--tw-prose-hr: hsl(var(--bc-border));
		--tw-prose-quotes: hsl(var(--bc-fg));
		--tw-prose-quote-borders: hsl(var(--bc-border));
		--tw-prose-captions: hsl(var(--bc-fg-muted));
		--tw-prose-code: hsl(var(--bc-fg));
		--tw-prose-pre-code: hsl(var(--bc-fg));
		--tw-prose-pre-bg: hsl(var(--bc-surface-2));
		--tw-prose-th-borders: hsl(var(--bc-border));
		--tw-prose-td-borders: hsl(var(--bc-border));

		color: hsl(var(--bc-fg));
		line-height: 1.7;
	}

	/* Typography adds backticks around inline code by default */
	.prose :where(code):not(:where(pre code))::before,
	.prose :where(code):not(:where(pre code))::after {
		content: none;
	}

	.prose :where(code):not(:where(pre code)) {
		font-size: 0.875em;
		padding: 0.2em 0.4em;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface-2));
	}

	/* Code block wrapper with copy button */
	.code-block-wrapper {
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		margin: 6px 0;
		overflow: hidden;
	}

	.code-block-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 4px 8px;
		border-bottom: 1px solid hsl(var(--bc-border));
		font-size: 12px;
	}

	.code-lang {
		color: hsl(var(--bc-fg-muted));
		text-transform: uppercase;
		letter-spacing: 0.05em;
		font-weight: 600;
	}

	.copy-btn {
		display: flex;
		align-items: center;
		gap: 4px;
		padding: 4px 8px;
		background: transparent;
		border: 1px solid hsl(var(--bc-border));
		color: hsl(var(--bc-fg-muted));
		font-size: 11px;
		cursor: pointer;
		transition: all 100ms ease;
	}

	.copy-btn:hover {
		background: hsl(var(--bc-surface-2));
		color: hsl(var(--bc-fg));
		border-color: hsl(var(--bc-fg-muted));
	}

	.code-content {
		overflow-x: auto;
		padding: 4px 6px;
	}

	/* Shiki code blocks - match web app style */
	pre.shiki,
	pre.shiki code {
		font-family: var(--font-family-geist-mono);
		font-size: 14px;
		line-height: 1.4;
	}

	pre.shiki {
		background: transparent !important;
		margin: 0;
		padding: 0;
	}

	pre.shiki code {
		padding: 0;
		border: none;
		background: transparent;
	}

	/* Shiki dual theme handling */
	pre.shiki span {
		color: var(--shiki-light, inherit);
	}

	:root.dark pre.shiki span {
		color: var(--shiki-dark, inherit);
	}

	/* Fallback for non-wrapped code blocks */
	.prose pre:not(.shiki):not(.code-content pre) {
		padding: 12px 14px;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface));
		overflow-x: auto;
		font-size: 13px;
		line-height: 1.6;
		margin: 12px 0;
	}

	.prose :where(pre):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
		margin-top: 2px !important;
		margin-bottom: 2px !important;
		padding: 1 !important;
	}

	.prose pre code {
		padding: 0;
		border: none;
		background: transparent;
		font-size: inherit;
	}

	/* Copy answer button */
	.copy-answer-btn {
		display: flex;
		align-items: center;
		gap: 4px;
		padding: 4px 8px;
		background: transparent;
		border: 1px solid hsl(var(--bc-border));
		color: hsl(var(--bc-fg-muted));
		font-size: 11px;
		cursor: pointer;
		transition: all 100ms ease;
	}

	.copy-answer-btn:hover {
		background: hsl(var(--bc-surface-2));
		color: hsl(var(--bc-fg));
		border-color: hsl(var(--bc-fg-muted));
	}

	/* Sandbox status indicator */
	.sandbox-status-indicator {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 36px;
		height: 36px;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface-2));
		flex-shrink: 0;
	}

	.sandbox-progress-bar {
		height: 4px;
		width: 200px;
		background: hsl(var(--bc-surface-2));
		border: 1px solid hsl(var(--bc-border));
		overflow: hidden;
	}

	.sandbox-progress-fill {
		height: 100%;
		background: hsl(var(--bc-accent));
		transition: width 300ms ease;
	}

	/* Reasoning block */
	.reasoning-block {
		padding: 8px 12px;
		border-left: 2px solid hsl(var(--bc-fg-muted) / 0.4);
		background: hsl(var(--bc-surface-2) / 0.5);
		color: hsl(var(--bc-fg-muted));
		font-size: 12px;
		line-height: 1.5;
	}

	/* Tool indicator */
	.tool-indicator {
		display: flex;
		align-items: center;
		gap: 8px;
		padding: 6px 10px;
		border: 1px solid hsl(var(--bc-border));
		background: hsl(var(--bc-surface-2));
		font-size: 12px;
		width: fit-content;
	}

	.tool-dot {
		width: 8px;
		height: 8px;
		border-radius: 50%;
	}

	.tool-dot-pending {
		background: hsl(var(--bc-fg-muted));
	}

	.tool-dot-completed {
		background: hsl(var(--bc-success));
	}

	/* Spinner animation */
	@keyframes spin {
		to {
			transform: rotate(360deg);
		}
	}

	.animate-spin {
		animation: spin 1s linear infinite;
	}
}

@layer utilities {
	.bc-reveal {
		animation: bc-enter 220ms ease-out both;
		animation-delay: var(--delay, 0ms);
	}

	@media (prefers-reduced-motion: reduce) {
		.bc-reveal {
			animation: none;
		}
	}
}

@keyframes bc-enter {
	from {
		opacity: 0;
		transform: translateY(4px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}
